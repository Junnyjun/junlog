# 기초

## 레디스(Redis)의 특징 및 활용

레디스(Redis)는 빠른 속도와 다양한 자료형을 제공하는 인메모리 데이터 구조 저장소(In-Memory Data Structure Store)로, 웹 시스템 등에서 널리 활용되고 있습니다.&#x20;

### 레디스를 사용하기까지

레디스는 BSD 라이선스의 오픈소스 소프트웨어로, ANSI C로 작성되었으며 아주 작은 메모리로도 데이터를 유지할 수 있습니다. 이 인메모리 데이터베이스는 뛰어난 성능과 간단하고 유연한 데이터베이스 기능, 그리고 간편한 설정이라는 장점이 있어 널리 사용되고 있습니다.

레디스는 주로 NoSQL 범주로 분류되며, 최근에는 용도에 따라 RDBMS와 함께 사용하는 방식이나 기업용 버전, 관리형 서비스를 제공하는 레디스도 있습니다.&#x20;

### 레디스의 특징

레디스의 가장 큰 특징은 속도가 빠르고, 자료형이 풍부해서 다양하게 활용할 수 있으며, 인메모리 데이터베이스이면서 동시에 많은 기능을 갖췄다는 점입니다.

#### **인메모리 데이터베이스(In-Memory Database)**

인메모리 데이터베이스는 메모리에 데이터를 보관하므로 디스크의 입출력 접근을 피하고, 병목 현상(bottleneck)을 예방하는 등 처리 속도가 뛰어난 데이터베이스를 말합니다. 레디스는 고속 메모리에서 처리를 수행하며, 메모리 사용량 최소화 등의 기술을 사용합니다. RDBMS를 사용할 때도 메모리에서 처리하는 경우가 많지만, 레디스는 특히 인메모리 처리에 최적화되어 있어 더 빠르게 동작합니다.&#x20;

물론 트레이드오프도 고려해야 합니다. 레디스가 동작하는 메모리는 SSD/HDD에 비해 가용성이 낮을 수 있으며, 그 후에 SQL은 가용성과 확장성, RDBMS의 강한 정합성과 ACID 특성을 보장하는 등의 장점을 포함한 NewSQL로 등장합니다. 이러한 기술을 통해 확장성 등을 해결하는 것이 실제 비즈니스 요구사항을 위해 필요한지 또는 관리나 구성의 복잡성 등의 단점이 없는지를 비교 및 검토할 필요가 있습니다.

#### 레디스의 동작 이미지

레디스가 어떻게 데이터를 저장하는지 그 내부를 살펴봅니다.\
여기서 주목해야 하는 부분은 여러 자료형의 복잡한 값이 키와 연결되어 있다는 점이며, 이와 같은 방식은 관계형 데이터베이스와 다르고, 일반적인 KVS보다도 값이 복잡할 수 있습니다. 레디스의 데이터 저장 방법에 대해 어느 정도 감을 잡았나요? 궁금한 점이 있다면 2장을 참고하기 바랍니다.

레디스가 어떤 것인지는 실제로 동작시켜보지 않으면 알 수 없는 부분도 있습니다. 그 첫걸음으로, 이 장에서는 레디스의 기능을 간결하게 추려서 설명하고, 직접 설치해보며 실행하는 내용까지 설명합니다.

#### 다른 데이터베이스와 어떻게 다른가

레디스는 MySQL이나 오라클 등과 같은 RDBMS와는 용도가 다릅니다. 우선, 범용성이 높고 표현력이 뛰어난 RDBMS를 사용할 수 없으며, RDBMS에 비해 트랜잭션 처리 기능이 일부 제한됩니다. 대신 인메모리 처리에 최적화되어 있어 RDBMS보다 빠르게 처리할 수 있는 경우가 많습니다. 또한 빠른 속도를 유지하면서 다양한 자료형과 기능도 갖추고 있습니다. 이러한 특징으로 인해 현대 웹 시스템 등에서 널리 사용되고 있습니다.

RDBMS에는 RDBMS만의 강점이 있고, 레디스에는 레디스만의 강점이 있어 함께 사용되는 경우가 많습니다. 다만 이러한 경우 레디스가 RDBMS를 완전히 대체하는 것은 아니므로 염두에 두어야 합니다. 레디스는 RDBMS와 보완적인 관계로 이해하는 것이 좋습니다.

#### 의존성이 적은 레디스

많은 사람이 라이브러리를 설치할 때 해당 라이브러리를 사용하는 패키지 간의 의존성을 해결하기 위해 고민합니다. 레디스의 특징 중 하나는 운영체제에서 외부 라이브러리를 따로 설치할 필요가 없도록 구현됐다는 점입니다. 따라서 다양한 환경에서 간단하게 설치할 수 있습니다. 또한 의존성을 줄였기 때문에 외부로부터 버그가 발생할 위험이 낮습니다.

#### 레디스의 활용

레디스는 대규모 웹사이트를 위한 도구에 국한되지 않고, 트위터나 깃허브와 같은 대규모 서비스뿐만 아니라 중소 규모의 서비스에서도 광범위하게 활용됩니다. 용도는 웹 애플리케이션 캐시에 국한되지 않습니다. 배치 처리, 메시지 큐, Pub/Sub 시스템 구축 등에도 사용할 수 있습니다(2장 참조). 비교적 활용 범위가 넓기 때문에 레디스의 기초를 배우면 개발에 도움이 됩니다.

그는 MySQL 기반의 실시간 웹사이트 분석 애플리케이션 서비스를 운영하고 있었습니다. 그러나 사용자가 증가하면서 처리 부하를 감당하기 어려운 상황에 부딪히게 되었고, 이때 레디스를 개발하고 서비스에 도입함으로써 MySQL의 병목 현상을 해결하게 되었습니다.

* RDBMS에서 처리 성능(특히 쓰기 처리)의 병목 현상을 해결할 방법이 필요한 경우
* RDBMS의 다양한 자료형과 기능(레디스 클러스터와 영속성 등)이 유스케이스에 부합하는 경우

#### 속도가 빠르고 기능이 많은 인메모리 데이터 저장소

레디스는 인메모리 내에서 데이터를 처리하여 속도가 빠른 데이터 구조 저장소라는 점이 매력적이며 다음과 같은 특징도 있습니다.

```
자료형과 기능 및 관련 명령어가 다양합니다.
Pub/Sub 기능과 HyperLogLog가 있습니다.
레디스 스트림의 스트림 처리를 할 수 있습니다.
여러 자료형과 기능 관련 명령어가 많습니다.
데이터 영속성 기능이 있습니다.
레플리케이션/클러스터 기능을 통한 확장성 및 가용성이 높습니다.
클라이언트/서버 모델 기반의 요청/응답 통신을 할 수 있습니다.
여러 클라이언트와 호환됩니다.
루아(Lua)를 통한 유연한 처리
싱글 스레드 기반 요청 이벤트 주도 처리
```

### **인메모리 동작 기반의 빠른 처리 속도**

앞서 언급했듯이, 레디스의 빠른 처리 속도는 큰 장점입니다. 인메모리, 작은 메모리 사용량, 추후 설명할 이벤트 주도 요청 등으로 인해 아주 빠르게 동작합니다.&#x20;

**다양한 자료형과 명령어**

레디스는 다양한 자료형을 통해 밀리초 미만으로 응답하면서, 복잡한 데이터 구조를 저장할 수 있으므로 캐시 외에 다양한 용도로도 활용하기 좋습니다. 자료형이 풍부하지만 결코 어려운 내용은 아닙니다. 명령어 종류도 다양하며, 하위 명령어를 포함하면 400여 종류에 가까운 명령어를 제공합니다.

#### **데이터 영속성**

레디스는 기본적으로 데이터의 영속성을 갖추고 있습니다. 인메모리이기 때문에 데이터의 휘발성을 고려할 수밖에 없지만, 레디스에서는 크게 두 가지 종류의 영속성을 제공합니다.

* **RDB(Redis Database)**: 스냅샷 생성 기능은 기본적으로 활성화되어 있으며, 설정한 시점에 백업을 생성합니다.
* **AOF(Append Only File)**: 장애 등이 발생했을 때 활용하기 쉬운 AOF도 있습니다. AOF는 기본적으로 비활성화되어 있지만, RDB와 조합하여 활성화시키면 데이터의 손실 위험을 최소화하면서 레디스의 재시작 시간을 단축할 수 있습니다(5.1.3절 참조).

**클라이언트/서버 모델 기반의 요청/응답 통신**

레디스는 쉽게 이해할 수 있는 클라이언트/서버 모델을 채택하여 요청/응답 방식으로 통신합니다.\
또한 레디스는 다양한 언어 클라이언트용 라이브러리가 있습니다. 공식 문서에 게재되어 있는 것만 해도 50개 언어를 지원합니다

```
루아(Lua)를 통한 유연한 처리
레디스는 루아 스크립트 기능을 내장하고 있으며, 루아 스크립트로 여러 개의 레디스 명령을 한번에 수행할 수 있습니다. 
데이터 추가하기와 가져오기 등 redis-cli에서 할 수 있는 작업을 스크립트를 통해 실행할 수 있습니다. 
루아 스크립트를 사용함으로써 유연성이 증가하고 성능의 이점도 기대할 수 있습니다.

루아 스크립트는 RDBMS의 저장 프로시저(Stored Procedure)와 유사하므로 쉽게 이해할 수 있을 것입니다. 
이와 같은 방식을 통해 데이터베이스에서 직접 처리하는 부분을 클라이언트에서 따로 프로그래밍하는 수고를 덜 수 있습니다.

루아 스크립트를 레디스 서버에 전달하여 일괄적으로 실행할 수 있습니다. 
일련의 명령어를 하나씩 실행하지 않고, 코드를 작성해서 일괄적으로 실행하기도 합니다. 
즉, 하나의 루아 스크립트는 하나의 레디스 명령어와 동일한 레벨로 수행됩니다.
이 경우, 코드의 실행은 원자적(atomic)으로 수행됩니다.
```

**싱글 스레드 기반 요청 이벤트 주도 처리**

레디스는 싱글 스레드 주도 처리 모델을 채택하고 있습니다. 싱글 스레드지만 이벤트 루프를 형성하여 많은 요청을 처리할 수 있으며, `ae`라는 고유 이벤트 주도 라이브러리를 사용합니다.&#x20;

싱글 스레드로 인한 성능 문제를 우려할 수 있지만, 싱글 스레드가 다른 지표(메트릭)에 비해 CPU 전체가 병목 현상을 일으키는 경우는 비교적 드뭅니다. 레디스를 여러 인스턴스로 실행하면 성능 문제를 어느 정도 해결할 수 있는 등 적절하게 사용하면 성능 문제를 해결할 수 있습니다.

또한 완전한 싱글 스레드가 아니라 성능을 위해서 부분적으로 멀티 스레드를 채택하고 있습니다.&#x20;
