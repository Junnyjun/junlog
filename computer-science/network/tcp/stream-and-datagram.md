# Stream\&Datagram

#### 스트림 (TCP)의 작동 방식

스트림은 연결 기반 통신으로, 데이터를 전송하기 전 반드시 송신자와 수신자 간의 \*\*가상 회선(Virtual Circuit)\*\*을 만듭니다. 이 과정은 3-way Handshake라는 절차를 통해 이루어집니다.

1. SYN (Synchronize): 송신자가 수신자에게 "연결을 시작해도 될까요?"라고 요청합니다.
2. SYN-ACK (Synchronize-Acknowledge): 수신자는 "네, 좋습니다. 그리고 저도 준비됐습니다."라고 응답하며 수락합니다.
3. ACK (Acknowledge): 송신자는 "알겠습니다, 이제 데이터를 보내겠습니다."라고 최종 확인을 보냅니다.

이렇게 연결이 성공적으로 수립되면, 데이터는 순서대로, 그리고 바이트 단위로 연속적으로 전달됩니다. TCP는 데이터가 잘 전달되었는지 확인하기 위해 \*\*수신 확인(Acknowledgement)\*\*을 사용하고, 만약 패킷이 누락되거나 오류가 발생하면 \*\*재전송(Retransmission)\*\*을 요청하여 데이터의 완전성을 보장합니다.

장점:

* 신뢰성: 데이터 손실 없이 정확하게 전달됩니다.
* 순서 보장: 보낸 순서대로 데이터가 수신됩니다.
* 흐름 제어: 수신자의 버퍼 상태를 확인하며 데이터 전송 속도를 조절해 과부하를 방지합니다.

단점:

* 느린 속도: 연결 설정과 오류 제어 때문에 통신에 지연이 발생합니다.
* 높은 오버헤드: 헤더 정보가 많고, 제어 메커니즘이 복잡합니다.

***

#### 데이터그램 (UDP)의 작동 방식

데이터그램은 비연결성 통신으로, 통신을 시작하기 전에 별도의 연결 절차가 없습니다. 송신자는 데이터를 단순히 포장하여 주소만 붙인 다음, 네트워크에 "던져버리는" 것과 같습니다.

UDP 데이터그램은 TCP보다 훨씬 간결한 헤더를 가집니다.

* Source Port, Destination Port: 출발지와 목적지 포트 번호를 나타냅니다.
* Length: 데이터그램 전체의 길이를 나타냅니다.
* Checksum: 헤더와 데이터의 무결성을 확인하는 용도이지만, 필수가 아니며 선택적으로 사용됩니다.

데이터그램은 순서, 도착 여부, 오류 여부를 전혀 확인하지 않기 때문에, 패킷이 중간에 손실되거나 순서가 뒤바뀌어 도착할 수 있습니다. 이러한 책임은 전적으로 애플리케이션 계층에 있습니다.

장점:

* 매우 빠른 속도: 연결 설정이나 재전송 절차가 없어 지연이 거의 없습니다.
* 낮은 오버헤드: 헤더가 8바이트로 매우 작아 효율적입니다.
* 간단한 구조: 복잡한 제어 기능이 없어 구현이 쉽습니다.

단점:

* 비신뢰성: 패킷 손실이 발생해도 이를 알 수 없고, 보정하지 않습니다.
* 순서 비보장: 여러 패킷이 다른 경로를 거쳐 도착할 수 있어 순서가 뒤바뀔 수 있습니다.

***

#### 선택 기준: 어떤 상황에 무엇을 사용해야 할까?

| 구분         | 스트림 (TCP)                                                                                                                    | 데이터그램 (UDP)                                                                                                                      |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| 핵심 가치      | 신뢰성과 정확성                                                                                                                     | 속도와 효율성                                                                                                                          |
| 적합한 애플리케이션 | - 파일 전송 (FTP): 단 1비트의 손실도 허용되지 않음\<br>- 웹 브라우징 (HTTP/HTTPS): 페이지의 모든 내용이 정확히 표시되어야 함\<br>- 이메일 (SMTP): 중요한 메시지가 빠짐없이 전달되어야 함 | - 온라인 게임: 실시간 반응이 중요하므로 약간의 패킷 손실은 감수\<br>- 스트리밍 (영상, 음성): 몇 프레임이 손실되어도 전체 흐름에 큰 지장이 없음\<br>- DNS 쿼리: 짧은 요청-응답이므로 빠르게 처리하는 것이 중요 |
