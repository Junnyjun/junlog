# TIME\_WAITs

서버에 `TIME_WAIT` 상태의 연결이 많을 때 발생하는 주된 비용은 CPU와 메모리 사용량 증가입니다. 각 `TIME_WAIT` 연결은 서버가 작은 양의 리소스를 유지하게 해 전반적인 성능에 영향을 미칠 수 있습니다. 특히 많은 클라이언트가 의도적으로 `TIME_WAIT` 상태를 유발하는 경우, 이는 서비스 거부(DDoS) 공격의 한 형태가 될 수 있습니다.

***

#### `TIME_WAIT`의 기능

`TIME_WAIT` 상태는 TCP 통신에서 신뢰성을 보장하는 핵심 메커니즘입니다. TCP 연결이 종료된 후, 해당 연결을 식별하는 4가지 요소(클라이언트 주소, 클라이언트 포트, 서버 주소, 서버 포트)가 일정 시간 동안 재사용되는 것을 방지합니다.

이러한 기능은 네트워크 지연으로 인해 이전 연결의 마지막 패킷이 새 연결로 잘못 전달되는 것을 막아줍니다. 예를 들어, A와 B가 연결을 닫고 곧바로 동일한 주소와 포트로 새로운 연결을 시작할 때, 이전 연결의 뒤늦은 패킷이 도착하면 새 연결이 혼란을 겪을 수 있습니다. `TIME_WAIT`는 이 문제를 해결하기 위해, 연결이 종료된 후에도 일정 시간 동안 해당 포트를 점유하고 있어 패킷을 구분할 수 있게 합니다.

***

#### `TIME_WAIT` 연결이 많을 때의 비용

`TIME_WAIT` 상태의 연결이 서버에 많아질 때 발생하는 주요 비용은 다음과 같습니다.

* 자원 소모: 각 `TIME_WAIT` 연결은 \*\*TCP 제어 블록(TCB)\*\*을 메모리에 유지해야 하므로, 미미하지만 CPU와 메모리 자원을 소모합니다. 수천, 수만 개의 `TIME_WAIT` 연결이 쌓이면 전체 시스템 자원에 부담을 주어 활성 연결 처리 성능을 저하시킬 수 있습니다.
* 서비스 거부(DDoS) 공격: 단일 클라이언트가 서버에 큰 피해를 주기 어렵지만, 여러 클라이언트가 고의적으로 짧은 시간 안에 많은 연결을 맺고 끊기를 반복하면 서버의 `TIME_WAIT` 상태 연결 수를 급증시킬 수 있습니다. 이로 인해 서버의 리소스가 고갈되어 정상적인 새 연결을 받지 못하는 DDoS 공격이 발생할 수 있습니다.

`TIME_WAIT` 상태는 네트워크 신뢰성에 필수적이므로, `TIME_WAIT`를 강제로 닫거나 소켓을 재사용하는 것은 위험을 초래할 수 있습니다. 이러한 설정을 변경할 때는 기존 연결의 패킷이 새로운 연결에 영향을 줄 가능성을 신중하게 고려해야 합니다.
