# 데이터 원본 아키텍처 패턴

총 네 가지 주요 패턴인 테이블 데이터 게이트웨이(Table Data Gateway), 행 데이터 게이트웨이(Row Data Gateway), 액티브 레코드(Active Record), 데이터 매퍼(Data Mapper)에 대해 논의하고 있습니다.

### 1. 테이블 데이터 게이트웨이 (Table Data Gateway)

테이블 데이터 게이트웨이는 데이터베이스 테이블에 대한 게이트웨이 역할을 하는 객체로, 단일 인스턴스가 해당 테이블의 모든 행을 처리합니다. 이 패턴은 SQL 쿼리를 캡슐화하여 애플리케이션 코드에서 SQL을 분리하고 데이터베이스 접근을 중앙 집중화하는 데 중점을 둡니다.

#### 주요 특징

* **SQL 캡슐화:** SQL 쿼리를 포함한 데이터베이스 접근을 한 곳에서 관리함으로써 코드의 유지보수성을 높입니다. 데이터베이스 관리자(DBA)가 SQL을 쉽게 찾고 튜닝할 수 있도록 도와줍니다.
* **상태 비유지:** 테이블 데이터 게이트웨이는 일반적으로 상태를 유지하지 않으며, 각 요청마다 데이터베이스와의 상호작용을 처리합니다.
* **데이터 반환 방식:** 여러 줄의 데이터를 반환해야 하는 경우, 맵(Map) 또는 데이터 전송 객체(Data Transfer Object, DTO)를 사용하여 데이터를 반환할 수 있습니다. 일부 환경에서는 레코드 셋(Record Set)을 반환하여 처리하는 방식이 더 효율적일 수 있습니다.

#### 사용 시점

테이블 데이터 게이트웨이는 간단한 데이터베이스 인터페이스 패턴으로, 트랜잭션 스크립트(Transaction Script)와 같은 간단한 비즈니스 로직을 처리할 때 특히 유용합니다. 도메인 모델(Domain Model)을 사용하는 경우에는 데이터 매퍼(Data Mapper)가 더 적합한 선택일 수 있습니다. 테이블 모듈(Table Module)과 함께 사용하면 특히 효과적입니다.

#### 예제

테이블 데이터 게이트웨이의 예로는 `PersonGateway` 클래스가 있으며, 이 클래스는 데이터베이스의 `Person` 테이블에 대한 모든 조회, 삽입, 업데이트, 삭제 작업을 처리합니다. SQL 쿼리는 클래스 내부에 캡슐화되어 있으며, 다른 코드가 이 메서드를 호출하여 데이터베이스와 상호작용합니다.

### 2. 행 데이터 게이트웨이 (Row Data Gateway)

행 데이터 게이트웨이는 데이터 소스의 단일 행에 대한 게이트웨이로 작동하는 객체로, 각 행마다 하나의 인스턴스를 가집니다. 이 패턴은 SQL 쿼리를 객체 메서드로 캡슐화하여, 각 행을 객체처럼 다룰 수 있도록 합니다.

#### 주요 특징

* **객체-행 매핑:** 각 데이터베이스 행에 대해 하나의 객체가 생성되며, 이 객체는 해당 행의 데이터를 표현하고 조작하는 메서드를 제공합니다.
* **데이터 접근의 캡슐화:** 데이터베이스 접근 코드가 객체 내에 숨겨져 있으며, 클라이언트는 메서드를 통해 데이터에 접근합니다.
* **다양한 데이터베이스와의 호환성:** 다양한 데이터베이스에서의 SQL 차이를 쉽게 처리할 수 있도록 합니다.

#### 사용 시점

행 데이터 게이트웨이는 트랜잭션 스크립트와 같은 패턴과 함께 사용할 때 특히 유용합니다. 이 패턴은 복잡한 비즈니스 로직이 필요 없는 경우에 적합하며, 도메인 모델을 사용할 때는 액티브 레코드나 데이터 매퍼 패턴이 더 나은 선택일 수 있습니다.

#### 예제

`PersonGateway` 클래스는 `Person` 테이블의 각 행을 나타내는 객체로 사용됩니다. 이 객체는 데이터베이스와의 상호작용을 처리하며, 예를 들어 `update` 메서드를 통해 데이터베이스의 특정 행을 업데이트할 수 있습니다.

### 3. 액티브 레코드 (Active Record)

액티브 레코드는 데이터베이스 테이블 또는 뷰의 행을 감싸고, 데이터베이스 접근을 캡슐화하며, 도메인 로직을 추가하는 객체입니다. 이 패턴은 데이터와 도메인 로직이 동일한 객체에 존재하게 하여, 데이터베이스와의 상호작용을 쉽게 처리할 수 있도록 합니다.

#### 주요 특징

* **데이터와 로직의 결합:** 도메인 객체가 스스로 데이터베이스와의 상호작용을 처리하며, 비즈니스 로직도 포함합니다.
* **도메인 모델과 데이터베이스의 밀접한 연관성:** 도메인 모델과 데이터베이스 테이블 구조가 밀접하게 연관되어 있습니다.
* **간단한 CRUD 작업에 적합:** 간단한 생성(Create), 읽기(Read), 업데이트(Update), 삭제(Delete) 작업을 쉽게 처리할 수 있습니다.

#### 사용 시점

액티브 레코드는 간단한 도메인 로직을 처리하는 경우에 유용합니다. 특히 도메인 모델과 데이터베이스 테이블 구조가 유사할 때 효과적입니다. 복잡한 비즈니스 로직이 있는 경우 데이터 매퍼 패턴이 더 적합할 수 있습니다.

#### 예제

`Person` 클래스는 `Person` 테이블의 행을 표현하며, 자신의 데이터를 데이터베이스에 저장하거나 불러오고, 필요한 도메인 로직을 수행할 수 있습니다. 예를 들어, `getExemption` 메서드는 특정 비즈니스 로직을 처리하는 기능을 가집니다.

### 4. 데이터 매퍼 (Data Mapper)

데이터 매퍼는 객체와 데이터베이스 간의 데이터를 이동시키는 레이어로, 두 구조를 독립적으로 유지할 수 있게 합니다. 이 패턴은 복잡한 도메인 모델과 데이터베이스 간의 매핑을 처리하는 데 적합합니다.

#### 주요 특징

* **독립적인 데이터 구조:** 데이터베이스와 도메인 모델 간의 독립성을 유지하며, 두 구조의 진화를 독립적으로 관리할 수 있습니다.
* **복잡한 매핑 처리:** 복잡한 객체 간의 관계, 상속, 컬렉션 등을 효과적으로 처리할 수 있습니다.
* **트랜잭션 관리:** 데이터 매퍼는 데이터베이스와의 트랜잭션 관리를 도와줍니다.

#### 사용 시점

데이터 매퍼는 복잡한 도메인 모델과 데이터베이스 간의 상호작용을 처리해야 할 때 유용합니다. 도메인 모델이 복잡하거나, 데이터베이스와의 의존성을 최소화하고자 할 때 주로 사용됩니다.

#### 예제

`PersonMapper` 클래스는 도메인 객체인 `Person`과 데이터베이스 테이블인 `people` 간의 데이터를 전송하는 역할을 합니다. 이 클래스는 데이터베이스의 구조를 도메인 객체에 매핑하며, 데이터베이스와 도메인 모델 간의 독립성을 유지합니다.
