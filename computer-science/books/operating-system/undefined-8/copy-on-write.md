# Copy-on-Write

\*\*Copy-on-Write (COW)\*\*는 프로세스 생성(fork) 시점의 오버헤드를 줄이기 위해 사용되는 기술입니다. 요구 페이징(Demand Paging)이 가상 메모리를 효율적으로 사용하는 데 도움이 되듯이, COW는 페이지 공유를 통해 프로세스 생성 시 메모리 사용량을 최소화합니다.

**기본 원리 (Basic Principle)**

* fork() 호출 시: 부모 프로세스가 `fork()` 시스템 호출을 통해 자식 프로세스를 생성할 때, 부모와 자식 프로세스는 페이지를 공유합니다.
* 공유 페이지 설정: 공유되는 페이지들은 \*\*복사 방지(copy-on-write)\*\*로 표시되며, 페이지 테이블에서 \*\*읽기 전용(read-only)\*\*으로 설정됩니다.
* 쓰기 발생 시 복사: 부모나 자식 프로세스 중 어느 하나라도 공유 페이지에 쓰기(write)를 시도하면, 운영체제는 해당 페이지를 위한 \*\*새로운 복사본(copy)\*\*을 만들고 쓰기를 시도한 프로세스에게 할당합니다. 이후 두 프로세스는 독립적인 페이지를 가집니다.

**COW의 장점**

* 오버헤드 감소: `fork()` 시점에 부모의 주소 공간 전체를 복사하는 대신, 페이지 테이블 항목(페이지의 물리적 위치 포인터)만 복사하고 페이지를 공유합니다. 이로 인해 프로세스 생성 속도가 크게 향상됩니다.
* 필요한 복사만 수행: 대부분의 `fork()` 호출 이후 자식 프로세스가 `exec()`를 호출하여 새로운 프로그램을 로드하기 때문에, 부모의 모든 페이지를 복사하는 것은 낭비입니다. COW는 실제로 수정되는 페이지에 대해서만 복사를 수행합니다.

**제로 필 온 디맨드 (Zero-fill-on-demand)**

COW와 관련된 중요한 개념입니다.

* 할당 방식: COW는 새로운 페이지를 할당받을 때, 그 내용이 모두 0으로 채워지도록 하는 제로 필 온 디맨드(zero-fill-on-demand) 기술을 사용합니다.
* 목적: 새로운 페이지가 할당되기 전에 0으로 채워져야만, 해당 페이지가 이전에 사용했던 프로세스의 오래된 데이터가 새로운 프로세스에게 노출되는 것을 방지할 수 있습니다.
* 구현: 유휴(free) 프레임 리스트에서 할당된 페이지는 사용되기 전에 0으로 초기화됩니다.

**스와핑 영역의 초기화**

운영체제는 새로운 페이지가 스와핑 영역(swap space)에 할당될 때도 0으로 채워지도록 합니다. 이는 보안 및 프라이버시를 보장하기 위한 조치입니다.
