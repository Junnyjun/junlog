# 파일 할당

파일 할당은 디스크의 블록들을 파일에 할당하여 디스크 공간을 효율적으로 사용하고 데이터에 대한 빠른 접근을 보장하는 방식입니다. 주요 파일 할당 방식은 다음과 같습니다.

**1. 연속 할당 (Contiguous Allocation)**

이 방식은 파일의 각 블록이 디스크에서 물리적으로 연속된 일련의 블록에 할당됩니다.

* 구현: 파일 제어 블록(FCB)에는 파일의 시작 블록 주소와 할당된 블록 수만 저장됩니다.
* 장점:
  * 접근 속도: 순차 접근과 직접 접근(Random Access)이 매우 빠릅니다. $$ $i$ $$번째 블록의 주소는 $$ $\text{시작 주소} + i$ $$로 즉시 계산됩니다.
  * I/O 효율성: 인접한 여러 블록을 한 번의 I/O 연산으로 전송할 수 있어 효율적입니다.
* 단점:
  * 외부 단편화: 파일 삭제 시 남은 공간이 새로운 파일에 할당될 수 없는 외부 단편화(External Fragmentation) 문제가 심각하게 발생합니다.
  * 파일 크기 증가: 파일을 확장하려면 할당된 공간 바로 다음에 연속된 여유 공간이 필요합니다. 공간이 없으면 전체 파일을 다른 연속된 공간으로 복사해야 합니다.

**2. 연결 할당 (Linked Allocation)**

이 방식은 파일의 각 블록이 디스크의 어디에든 분산되어 저장될 수 있으며, 각 블록에는 다음 블록의 주소를 가리키는 포인터가 포함됩니다.

* 구현: FCB에는 첫 번째 블록의 주소와 마지막 블록의 주소만 저장됩니다.
* 장점:
  * 단편화 해결: 외부 단편화가 전혀 발생하지 않습니다. 사용 가능한 모든 블록을 파일 할당에 사용할 수 있습니다.
  * 파일 크기 증가: 파일은 빈 디스크 블록만 있다면 쉽게 확장됩니다.
* 단점:
  * 직접 접근 불가능: $$ $i$ $$번째 블록을 찾으려면 첫 블록부터 $$ $i$ $$개의 포인터를 순차적으로 따라가야 하므로 직접 접근이 매우 느립니다.
  * 공간 낭비 및 오버헤드: 각 블록의 작은 부분(포인터 공간)이 데이터 저장에 사용되지 않아 내부 단편화를 유발합니다. 또한 포인터 손상 시 이후 데이터 접근이 불가능해지는 신뢰성 문제가 있습니다.

**파일 할당 테이블 (File-Allocation Table, FAT)**

연결 할당의 단점을 보완하기 위해 사용되는 방식입니다.

* 원리: 모든 포인터를 디스크의 \*\*특정 영역(FAT)\*\*에 모아서 저장합니다. FAT 테이블은 메모리에 캐시되어 성능을 높입니다.
* 특징: 데이터 블록 자체에는 포인터를 저장할 필요가 없어 내부 단편화가 줄어들지만, $$ $i$ $$번째 블록 접근 시 FAT 테이블을 순차적으로 탐색해야 하는 순차적 특성은 여전히 남아 있습니다.

**3. 색인 할당 (Indexed Allocation)**

이 방식은 파일의 모든 디스크 블록 주소를 모아놓은 전용 \*\*색인 블록(Index Block)\*\*을 사용하는 방식입니다.

* 구현: FCB에는 색인 블록의 주소만 저장합니다. 색인 블록에는 파일의 모든 데이터 블록 주소가 순서대로 저장됩니다.
* 장점:
  * 단편화 해결: 외부 단편화가 발생하지 않습니다.
  * 직접 접근: $$ $i$ $$번째 블록을 찾으려면 FCB $$ $\rightarrow$ $$ 색인 블록 $$ $\rightarrow$ $$ $$ $i$ $$번째 항목을 참조하여 주소를 얻으므로 직접 접근이 빠릅니다.
* 단점:
  * 오버헤드: 작은 파일이라도 데이터를 읽으려면 색인 블록을 읽는 추가적인 디스크 I/O가 필요합니다.
  * 파일 크기 제한: 하나의 색인 블록이 담을 수 있는 주소의 수가 제한되어 파일의 최대 크기가 제한될 수 있습니다.

**대용량 파일 처리를 위한 색인 할당 (Combined Schemes)**

대용량 파일 지원을 위해 색인 블록의 한계를 극복하는 구조가 사용됩니다.

* 연결된 색인 블록: 색인 블록이 가득 차면, 마지막 엔트리가 다른 색인 블록을 가리키도록 연결합니다.
* 다단계 색인: 색인 블록의 엔트리가 데이터 블록이 아닌 다른 색인 블록을 가리키도록 하여 여러 레벨의 포인터 구조를 만듭니다. (예: 2단계, 3단계 색인)
* 결합된 기법 (Unix Inode): 작은 파일에는 직접 포인터(Direct Pointer)를 사용하고, 큰 파일에는 단일, 이중, 삼중 간접 포인터를 결합하여 유연성과 효율성을 동시에 확보합니다.
