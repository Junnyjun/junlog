# 변환 스트림

변환 스트림은 응용 프로그램의 단순한 I/O 요청(예: `read` 시스템 호출)이 커널 I/O 서브시스템의 여러 계층을 거쳐 실제 하드웨어의 물리적 동작(예: 디스크 컨트롤러 명령)으로 변환되는 전체 과정을 의미합니다. 이 과정은 I/O 시스템의 복잡성과 효율성을 모두 보여줍니다.

**1. I/O 요청의 전체 흐름**

I/O 요청은 응용 프로그램 계층에서 하드웨어 계층까지 다음과 같은 주요 단계들을 거쳐 변환됩니다.

* 응용 프로그램 계층:
  * 사용자 프로세스가 라이브러리 호출 (예: C 표준 라이브러리의 `fread`)을 수행합니다.
  * 이 호출은 최종적으로 시스템 호출 (예: `read()`)을 통해 커널 모드로 진입합니다.
* 논리적 I/O 계층:
  * 커널 I/O 서브시스템이 요청을 받습니다.
  * 이 계층은 요청된 파일의 FCB(File Control Block) 또는 Inode를 찾고, 접근 권한을 확인합니다.
  * 논리적 블록 번호 (파일 내 $$ $i$ $$번째 블록)를 결정합니다.
* 파일 구성 모듈 (File Organization Module):
  * 논리적 블록 번호를 물리적 블록 번호 (디스크 내 실제 주소)로 변환합니다.
  * 파일 할당 기법(연속, 연결, 색인 등)에 따라 이 변환 작업을 수행합니다.
* 기본 파일 시스템 (Basic File System):
  * 물리적 블록 번호를 인수로 받아 해당 블록을 메모리로 전송할 준비를 합니다.
  * 이 계층은 버퍼 캐시를 확인하여 요청된 블록이 이미 메모리에 있는지 검사합니다. 캐시 미스 시 하위 계층으로 요청을 전달합니다.
* I/O 제어 계층 (I/O Control):
  * 디바이스 드라이버와 버퍼 캐시 관리자가 위치합니다.
  * 디바이스 드라이버는 범용적인 읽기 요청을 특정 하드웨어가 이해할 수 있는 저수준 명령어로 변환합니다.
  * 디스크 요청의 경우, 여기서 디스크 스케줄링을 수행하여 요청 순서를 최적화합니다.
* 하드웨어 계층 (Hardware):
  * 디바이스 드라이버로부터 명령을 받은 장치 컨트롤러가 실제 하드웨어(디스크 암 이동, 헤드 읽기/쓰기)를 조작합니다.
  * 데이터는 DMA를 통해 로컬 버퍼에서 메인 메모리로 직접 전송됩니다.
  * 작업이 완료되면 인터럽트를 통해 CPU에 완료를 알립니다.

**2. 핵심 변환 요소: 주소 변환**

I/O 변환 스트림에서 가장 중요한 작업은 주소의 변환입니다.

* 논리적 주소 (Logical Address): 응용 프로그램이 파일 내에서 요청하는 상대적인 위치 (바이트 오프셋).
*   논리적 블록 번호 (Logical Block Number): 파일 내에서 해당 바이트 오프셋이 속하는 블록의 번호.

    \$$ \text{논리적 블록 번호} = \lfloor \text{바이트 오프셋} / \text{블록 크기} \rfloor\$$
* 물리적 블록 번호 (Physical Block Number): 디스크 전체에서 해당 블록이 위치하는 절대적인 번호. 이는 파일 구성 모듈이 파일 할당 정보(FCB/inode)를 참조하여 변환합니다.
* 물리적 주소 (Physical Address): 장치 컨트롤러가 인식하는 실제 위치 (실린더, 트랙, 섹터). 이는 디스크 컨트롤러가 물리적 블록 번호를 최종적으로 변환합니다.

**3. DMA를 통한 데이터 흐름**

고속 I/O 장치의 경우, 데이터 전송 단계는 CPU의 개입을 최소화하는 \*\*DMA(Direct Memory Access)\*\*를 통해 효율화됩니다.

* 디바이스 드라이버는 DMA 컨트롤러에게 메인 메모리 내 전송 목적지 주소와 전송할 데이터 크기를 설정합니다.
* 장치 컨트롤러는 CPU를 거치지 않고 직접 메인 메모리(RAM)와 데이터를 교환합니다.
* 전송이 완료되면 DMA 컨트롤러는 CPU에게 하나의 인터럽트만 발생시켜 I/O 완료를 통보합니다.
