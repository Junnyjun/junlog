# 도메인 객체의 생명주기

모든 객체에는 생명주기가 있다.\
MODEL-DRIVEN DESIGN에서는 이러한 객체들을 관리하는것이 중요하다.

<img src="../../../.gitbook/assets/file.excalidraw.svg" alt="" class="gitbook-drawing">

도메인 객체의 관리와 관련된 문제는 두 가지 범주로 나뉜다.

1. 생명주기 동안의 무결성 유지하기
2. 생명주기 관리의 복잡성으로 모델이 난해해지는 것을 방지하기

AGGREGATE, FACTORY, REPOSITORY 세 가지 패턴을 사용해서 문제를 해결한다.

## AGGREGATE (집합체)

데이터 변경의 단위로 다루는 연관 객체의 묶음

```
경계 : AGGREATE에 무엇이 포함되고 포함되지 않는지를 정의
루트 : 하나만 존재하며, AGGREGATE에 포함된 특정 ENTITY를 가리킴
```

### 경계 안의 객체는 서로 참조할 수 있지만, 경계 바깥의 객체는 루트만 참조할 수 있다.  AGGREGATE 적용 규칙

루트 ENTITY는 전역 식별성을 지니며 궁극적으로 불변식을 검사할 책임이 있다.

각 루트 ENTITY는 전역 식별성을 지닌다. 경계 안의 ENTITY는 지역 식별성을 지니며, \
이러한 지역 식별성은 해당 AGGREGATE 안에서만 유일하다.

AGGREGATE 의 경계 밖에서는 루트 ENTITY를 제외한,\
AGGREGATE 내부의 구성요소를 참조할 수 없다.

AGGREGATE 안의 객체는 다른 AGGREGATE의 루트만 참조할 수 있다.\
삭제 연산은 AGGREGATE의 객체 안에 모든 요소를 한 번에 제거해야 한다.

AGGREGATE 경계 안의 어떤 객체를 변경하더라도 전체 AGGREGATE의 불변식은 모두 지켜져야 한다.

## FACTORY (팩터리)

객체를 생성하는 책임을 맡고있는 프로그램 요소

복합한 객체나 AGGREGATE를 생성하는데 필요한 지식을 캡슐화

클라이언트의 목적과 생성된 객체의 추상적인 관점을 반영하는 인터페이스를 제공

<img src="../../../.gitbook/assets/file.excalidraw (1).svg" alt="" class="gitbook-drawing">

### FACTORY 설계를 위한 기본 요건

각 생성 방법은 원자적이어야 하며, 생성된 객체나 AGGREGATE의 불변식을 모두 지켜야한다.

생성된 클래스보다는 생성하고자하는 타입으로 추상화되어야 한다.

다형성을 활용하지 않는 간단한 객체까지 FACTORY를 사용하면 이해하기 어려워질 수 있다.

### 공개 생성자만으로 충분한 경우

클래스가 타입인 경우, 클래스가 어떤 계층구조의 일부를 구성하지 않으며, \
인터페이스를 구현하는 식으로 다형적으로 사용되지 않는 경우

&#x20;클라이언트가 STRATEGY를 선택하는 한 방법으로서 구현체에 관심이 있는 경우

클라이언트가 객체의 속성을 모두 이용할 수 있어서 클라이언트에게 노출된 생성자 내에서 객체 생성이 중첩되지 않는 경우

생성자가 복잡하지 않은 경우\
공개 생성자가 FACTORY와 동일한 규칙을 반드시 준수해야하는 경우
