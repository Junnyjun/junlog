# Cache

자주 쓰이는 문서를 보관해두는 Http 장치이다.\
불필요한 데이터 전송, 네트워크 병목, 서버의 요청 등 여러 방면으로 성능을 개선해준다.

```
- 캐시는 불필요한 데이터 전송을 줄여서, 네트워크 요금으로 인한 비용을 줄여 준다.
- 캐시는 네트워크 병목을 줄여준다. 대역폭을 늘리지 않고도 페이지를 빨리 불러올 수 있게 된다.
- 캐시는 원 서버에 대한 요청을 줄여준다.서버는 부하를 줄일 수 있으며 더 빨리 응답할 수 있게 된다.
```

### 적중과 부적중&#x20;

캐시는 유용하지만 세상 모든 문서의 사본을 저장하지 않습니다. \
캐시에 요청이 도착했을 때, 대응하는 사본이 있다면 그 사본을 이용해 요청이 처리될 수 있습니다. \
이를 캐시 적중(cache hit)이라고 합니다. \
대응하는 사본이 없다면 원 서버로 요청이 전달되며, 이를 캐시 부적중(cache miss)이라고 합니다.

#### 재검사(Revalidation)&#x20;

원 서버 콘텐츠는 변경될 수 있기 때문에, \
캐시는 그들이 갖고 있는 사본이 여전히 최신인지 서버를 통해 때때로 점검해야 합니다. \
이러한 '신선도 검사'를 HTTP 재검사라고 부릅니다.&#x20;

콘텐츠가 변경되지 않았다면, 서버는 아주 작은 304 Not Modified 응답을 보낸다.\
그 사본이 여전히 유효함을 알게 된 캐시는 즉각 사본이 신선하다고 임시로 다시 표시한 뒤,\
&#x20;그 사본을 클라이언트에 제공한다

**재검사 적중 혹은 느린 적중**이라고 부른다.&#x20;

`재검사 적중` : 서버 객체가 변경되지 않았다면, 서버는 클라이언트에게 작은 HTTP 304 NotModified 응답한다\
`재검사 부적중` : 만약 서버 객체가 캐시된 사본과 다르다면, 서버는 콘텐츠 전체와 함께 평범한 HTTP 200 OK 응답을 클라이언트에게 보낸다.\
`객체 삭제` : 서버 객체가 삭제되었다면, 서버는 404 Not Found 응답을 돌려보내며, 캐시는 사본을 삭제한다.

### 적중률

캐시가 요청을 처리하는 비율을 캐시 적중률&문서 적중률이라 한다.\
적중률은 0에서 1까지의 값이지만, 흔히 퍼센트로 표현되기도 한다.

```
실제 적중률은 캐시가 얼마나 큰지
캐시 사용자들의 관심사가 얼마나 비슷한지
캐시된 데이터가 얼마나 자주 변경되거나 개인화되는지
캐시가 어떻게 설정되어 있는지
```

적중률은 예측하기 어려운 것으로 악명이 높지만 오늘날 적중률 40% 면 웹 캐시로 괜찮은 편이다.\
다행인 사실은, 보통 크기의 캐시라도 충분한 분량의 자주 쓰이는 문서들을 보관하여 상당히 트래픽을 줄이고 성능을 개선할 수 있다는 점이다.\
캐시는 유용한 콘텐츠가 캐시 안에 머무르도록 보장하기 위해 노력한다.

#### 적중과 부적중의 구별

불행히도, HTTP는 클라이언트에게 응답이 캐시 적중이었는지 아니면 원 서버 접근인지 말해줄 수 있는 방법을 제공하지 않는다.두 경우 모두 응답 코드는 응답이 본문을 갖고 있음을 의미하는 200 OK가 될 것이다.

클라이언트가 응답이 캐시에서 왔는지 알아내는 한 가지 방법은 Date 헤더를 이용하는 것이다.응답의 Date 헤더 값을 현재 시각과 비교하여, 응답의 생성일이 더 오래되었다면 클라이언트는 응답이 캐시된 것임을 알아낼 수 있다.

### 캐시 토폴로지

캐시는 한 명의 사용자에게만 할당될 수도 있고 반대로 수천 명의 사용자들 간에 공유될 수도 있다.

#### 개인전용캐시

개인 전용 캐시는 많은 에너지나 저장 공간을 필요로 하지 않으므로, 작고 저렴할 수 있다.\
브라우저는 자주 쓰이는 문서를 개인용 컴퓨터의 디스크와 메모리에 캐시해 놓고,사용자가 캐시 사이즈와 설정을 수정할 수 있도록 허용한다.

익스플로러는 캐시된 문서를 ‘임시 파일’이라고 부르고 연관된 URL 및 문서 만료 시각과 함께 파일 목록에 나열한다.

#### 공용 프락시 캐시

캐시 프록시 서버&프록시 캐시라고 불리는 특별한 종류 의 공유된 프락시 서버다\
프락시 캐시는 로컬 캐시에서 문서를 제공하거나, 혹은 사용자의 입장에서 서버에 접근한다.\
공용 캐시에는 여러 사용자가 접근하기 때문에, 불필요한 트래픽을 줄일 수 있는 더 많은 기회가 있다.

각 개인 전용 캐시는 같은 문서를 네트워크를 거쳐 여러 번 가져온다\
캐시는 자주 찾는 객체를 단 한 번만 가져와 모든 요청에 대해 공유된 사본을 제공함으로써,\
네트워크 트래픽을 줄인다.

#### 프락시 캐시 계층들

작은 캐시에서 캐시 부적중이 발생했을 때 더 큰 부모 캐시가 트래픽을 처리하도록 \
하는 계층을 만드는 방식이 합리적인 경우가 많다.

#### 캐시망, 콘텐츠 라우팅, 피어링

몇몇 네트워크 아키텍처는 단순한 캐시 계층 대신 복잡한 캐시망을 만든다. \
캐시망의 프락시 캐시는 복잡한 방법으로 서로 대화하여 캐시 커뮤니케이션 결정을 동적으로 내린다.

```
- URL에 근거하여, 부모 캐시와 원 서버 중 하나를 동적으로 선택한다.
- URL에 근거하여 특정 부모 캐시를 동적으로 선택한다.
- 부모 캐시에게 가기 전에, 캐시된 사본을 로컬에서 찾아본다.
- 다른 캐시들이 그들의 캐시된 콘텐츠에 부분적으로 접근할 수 있도록 허용하되,
그들의 캐시를 통한 인터넷 트랜짓(Internet transit)9은 허용하지 않는다.
```

이러한 한층 더 복잡한 캐시 사이의 관계는, \
서로 다른 조직들이 상호 이득을 위해 그들의 캐시를 연결하여 서로를 찾아볼 수 있도록 해준다.

선택적인 피어링을 지원 하는 캐시는 형제 캐시라고 불린다\
ICP\&HTCP 프로토콜을 이용해 HTTP를 확장했다.
